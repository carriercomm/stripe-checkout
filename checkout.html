<!--
- Stripe sample checkout
- author: John Collison <john@stripe.com>
-
- Copyright (c) 2011 Stripe, Inc.
- Licensed under the MIT license:
- http://www.opensource.org/licenses/mit-license.php
-->

<!--
- You cannot simply open this as a html file! You
- need to host it and access it through localhost.
-->

<html>
  <head>
	  <title>Stripe checkout</title>
	  <style>
	  .badinput {border:2px solid red;}
	  #checkout_form img {height:25;}
	  #topbar {display:inline-block;margin-bottom:1px;margin-left:2px;}
	  #error_text {color:red;margin-left:2px;margin-top:1px;}
	  </style>
  </head>
  
  <body>
    <form id="checkout_form">
      <div id="topbar">
        <img src="img/visa.png" />
        <img src="img/mastercard2.png" />
        <img src="img/american-express2.png" />
        <img src="img/discover.jpg" />
      </div>
      <div id="ccform">
        <input name="number" placeholder="Card number" title="Card number" />
        <select name="exp_month"></select>
        <select name="exp_year"></select>
        <input name="pay" type="submit" value="Pay">
      </div>
      <div id="error_text">
        
      </div>
    </form>
    
    <p><a href="https://github.com/collision/stripe-checkout">Get the source on GitHub</a>
    
    <script>
    var amount = 2000; // $20
    var STRIPE_API_KEY = 'pk_dHA9lrZx2If0QQyGU3aHUf8K8J5PW'; // Replace with your own
    
    function successful_charge(resp) {
      debug.log(resp);

      wipe_errors();
      descriptive_submit_button();
      $('input[name=pay]').val('Paid');
      
      // redirect 'success.php?charge=' + resp.id
      // or whatever
      $('body').html('<h1>Payment received</h1>');
    }
    
    function error_text(msg) {
      $('#error_text').html(msg);
    }
    
    function wipe_errors() {
      $('#error_text').html('');
    }
    
    function card_error(e) {
      switch (e.param) {
        case 'number':
          $('input[name=number]').addClass('badinput');
        default:
          true
      }
      error_text(e.message);
    }
    
    function bad_error(e) {
      // Ouch
      debug.error(e)
    }
    
    function error(e) {
      descriptive_submit_button();
      $('input[name=pay]').attr('disabled', '');
      
      debug.log(e);
      if (e.type == 'card_error') {
        card_error(e);
      } else {
        bad_error(e);
      }
    }
    
    function pay(submitted) {
      $('input[name=pay]').attr('disabled', 'disabled');
      $('input[name=pay]').val('Paying...');
      var card = {}; $.each(submitted, function(i,n) {card[n.name] = n.value});
      Stripe.executeCharge({amount:amount,currency:'usd',key:STRIPE_API_KEY,card:card}, successful_charge, error);
      return false;
    }
    
    function month(num) {
      return ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'][num];
    }
    
    function init_expiries() {
      // Populate the expiry dropdowns
      var i = 1; while(i <= 12) {$('select[name=exp_month]').append('<option value="' + i + '">' + i + ' - ' + month(i-1) + '</option>'); i++}
      var y = new Date().getFullYear(); while (y <= (new Date().getFullYear() + 15)) {$('select[name=exp_year]').append('<option value="' + y + '">' + y + '</option>'); y++}
    }
    
    function descriptive_submit_button() {
      $('input[name=pay]').val('Pay $' + (amount/100.0).toFixed(2));
    }
    
    function init() {
      init_expiries();
      descriptive_submit_button();
      $('form').submit(function() {
        pay($(this).serializeArray());
        return false;
      });
      $('input[name=number]').keydown(function(){$(this).removeClass('badinput')});
    }
    window.onload = init;
    </script>
    
    <!-- Stripe's js lib doesn't require JQuery, but we'll use it here for convenience -->
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.4.4/jquery.min.js"></script>
    
    <script type="text/javascript" src="https://eta.stripe.com/stripe.js"></script>
  </body>
</html>